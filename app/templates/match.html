{% extends 'base.html' %}{% block content %}
<h1>Match</h1>
<div class='card'>
  <label class='small'>Job を選ぶ</label>
  <div style='display:flex;gap:8px;align-items:center;margin-top:6px'>
    <select id='job' class='input' style='min-width:320px'></select>
    <button id='run' class='btn'>Match</button>
  </div>
</div>
<div class='card'><div id='out' class='small'>求人を選択して「Match」を押してください。</div></div>
<style>
.score-badge{display:inline-block;min-width:48px;padding:2px 6px;border-radius:6px;text-align:center;font-weight:700;color:#fff}
.score-high{background:#22c55e}.score-mid{background:#eab308}.score-low{background:#ef4444}
/* ← 追加：名前は白文字・太字（背景なし） */
.name-text{font-weight:600;font-size:15px;color:#fff}
</style>
<script>
(function(){
  function esc(x){return (x==null?'':String(x))}
  function badgeList(xs){xs=xs||[];var out=[];for(var i=0;i<xs.length;i++){out.push('<span class=\"badge\">'+esc(xs[i])+'</span>')}return out.join(' ')}
  function loadJobs(){
    fetch('/api/jobs').then(function(r){return r.json()}).then(function(jobs){
      var opts=[];for(var i=0;i<jobs.length;i++){var j=jobs[i];opts.push('<option value=\"'+j.id+'\">'+j.id+': '+esc(j.title)+' / '+esc(j.company||'')+'</option>')}
      document.getElementById('job').innerHTML=opts.join('');
    });
  }
  function run(){
    var id=document.getElementById('job').value;
    fetch('/api/match?job_id='+id).then(function(r){return r.json()}).then(function(data){
      var rows=[],res=data.results||[];
      for(var i=0;i<res.length;i++){
        var r=res[i],s=r.score,cls=(s>=0.8?'score-high':(s>=0.5?'score-mid':'score-low'));
        rows.push('<tr>'+
          '<td><span class=\"name-text\">'+esc(r.candidate.name)+'</span></td>'+
          '<td><span class=\"score-badge '+cls+'\">'+s+'</span></td>'+
          '<td class=\"small\">'+esc(r.reasons)+'</td>'+
          '<td>'+badgeList(r.candidate.skills)+'</td>'+
        '</tr>');
      }
      var head='<h2 style=\"margin-top:0\">'+esc(data.job.title)+' <span class=\"small\">/ '+esc(data.job.company||'')+'</span></h2>'+
               '<div class=\"kv\" style=\"margin-bottom:10px\"><div>勤務地: '+esc(data.job.location||'')+'</div><div>年収: '+((data.job.min_salary||0))+'〜'+((data.job.max_salary||0))+' 万円</div><div>雇用: '+esc(data.job.employment_type||'')+'</div></div>';
      var table='<table class=\"table\"><tr><th>Candidate</th><th>Score</th><th>Reasons</th><th>Skills</th></tr>'+
                (rows.join('')||'<tr><td colspan=\"4\" class=\"small\">候補者が見つかりません</td></tr>')+
                '</table>';
      document.getElementById('out').innerHTML=head+table;
    }).catch(function(e){document.getElementById('out').textContent='読み込みエラー: '+e;console.error(e);});
  }
  document.getElementById('run').addEventListener('click', run);
  loadJobs();
})();
</script>
{% endblock %}
